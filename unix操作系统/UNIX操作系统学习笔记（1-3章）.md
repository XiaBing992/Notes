# UNIX操作系统学习笔记（1-3章）

## 第一章  系统概貌

### **系统结构**

- 操作系统直接与硬件交互，向程序提供服务
- 外层的程序通过一组系统调用来与内核交互

### 文件系统

**UNIX文件系统的特点：**

- 层次结构
- 文件的动态增长
- 建立与删除文件的能力
- 文件数据的保护
- 将外围设备当做文件对待

**在UNIX系统中，将数据作为无格式的字节流看待，程序按照自己的意愿去解释字节流**

**一个文件的存储控制权（控制读、写、执行）：**

- 文件所有者
- 同组用户
- 其他人

### 处理环境

**在UNIX系统上可以同时执行多个进程，并且系统可以同时存在一个程序的多个实例**

**shell允许的三种命令：**

- 一个命令是一个执行文件
- 一个命令包含一系列shell命令行的可执行文件
- 一个命令是一个内部shell命令

### 构件原语

**进程通常可以存取三个文件：**

- 从标准输入文件上读
- 从标准输出文件上写
- 把错误文件写到标准错误文件上

### 关于硬件的假设

UNIX上将用户进程的执行分为两个级别：用户与内核

**两者的区别：**

- 用户态下的进程能存取他们自己的指令和数据，但不能存取内核指令和数据
- 用户态下没有执行特权指令的能力

### 中断与例外

**当接收到中断时，内核保存它的上下文，判断中断原因，为中断服务，在内核为中断服务之后，恢复被中断的上下文，继续执行。当内核为某个中断服务时，封锁较低优先级的中断，为更高优先级的中断服务。**





## 第二章  内核导言

### UNIX操作系统的体系结构

**中断不是由特殊进程服务的，而是内核中的特殊函数服务的** 

### 文件子系统概貌

**内核的其他数据结构：**

- 文件表。全局核心结构
- 文件描述符表。对每个进程分配一个
- 索引节点。当一个文件被建立时，内核分配其一个尚未使用的索引结点。当要操纵文件时，内核将其读到内存中

**一个文件系统具有以下结构：**

- 引导块。占据文件系统的开头，含有起引导或者初起操作系统的引导代码。
- 超级块。描述了文件系统的状态。
- 索引节点表。装有索引节点的表。
- 数据块。包含文件数据和管理数据。

**进程**

- 0进程是一个特殊进程，在系统引导时“手工”创建。

- 1进程被称为init进程，是系统中每个进程的祖先。

- 除了0进程，每个进程都是被另一个进程执行系统调用fork时创建的。
- UNIX系统中的核心栈和用户栈是分开的
- 每个进程在内核进程表中都有一个表项，并且每个进程都被分配一个u区，其包含仅被内核操纵的私有数据
- 仅当进程从“核心态运行”状态转移到“在内存中睡眠”时，内核才允许上下文切换，在核心态运行的进程不允许被其他进程抢占

**睡眠与唤醒**

- 一个中断处理程序不能睡眠
- **内核是不可抢占的，一个在核心态执行的进程将连续执行，直至进入睡眠状态或者返回用户态执行时为止**

## 第三章 数据缓冲区高速缓存

### 缓冲头部

缓冲区是磁盘在内存中的拷贝

**一个缓冲区由两部分组成：**

- 一个含有磁盘上的数据的存储器数组
- 一个用来标识该缓冲区的**缓冲头部**

**缓冲头部的组成：**

- 设备号（逻辑文件系统号）
- 块号
- 状态（上锁、开锁）
- 指向数据区域的指针
- 指向散列队列的上下两个缓冲区的指针
- 指向空闲表的上下两个指针

### 缓冲池的结构

每个缓冲区总是存在一个散列队列中，如果一个缓冲区为空闲状态，则它也可以在空闲表中。

内核存取一个磁盘块时，通过**设备号与块号**组合去找到相应的缓冲区

**内核通过两种方法找到缓冲区：**

- 搜索特定缓冲时，则它搜索散列队列
- 寻找任何一个空闲缓冲区时，从空闲表中寻找

**当空闲表标上了“延迟写”时，要先将缓冲区内容写到磁盘上**

**高速缓冲的优点和缺点：**

- 提供了统一的磁盘存取方法
- 对进行IO的用户没有做数据对齐限制
- 减少了访盘次数
- 有助于确保系统完整性